<!doctype html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Elite DriveGuard BLE Controller</title>
<style>
  body{font-family:system-ui,sans-serif;margin:0;background:#0b0f14;color:#e6edf3}
  .wrap{max-width:520px;margin:0 auto;padding:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:12px 0}
  button{font-size:18px;padding:16px;border-radius:14px;border:0;background:#1f2937;color:#e6edf3}
  button:active{transform:scale(.98)}
  .primary{background:#2563eb}.danger{background:#ef4444}.ok{background:#16a34a}.muted{background:#374151}
  .card{background:#111827;padding:12px;border-radius:16px;margin:12px 0}.title{font-size:20px;margin:6px 0 12px}
  .status{font-size:14px;opacity:.85}
</style>
<body>
<div class="wrap">
  <h2>Elite DriveGuard BLE Controller</h2>

  <div class="card">
    <div class="row">
      <button class="primary" onclick="connect()">Connect</button>
      <button class="danger" onclick="disconnect()">Disconnect</button>
    </div>
    <div id="status" class="status">Not connected</div>
  </div>

  <div class="card">
    <div class="title">Modes</div>
    <div class="row">
      <button onclick="sendChar('0')">Idle (0)</button>
      <button class="ok" onclick="sendChar('1')">Auto (1)</button>
    </div>
    <div class="row">
      <button onclick="sendChar('2')">Remote (2)</button>
      <button onclick="sendChar('3')">CACC (3)</button>
    </div>
    <div class="row">
      <button onclick="sendChar('4')">IMA (4)</button>
    </div>
  </div>

  <div class="card">
    <div class="title">Remote Controls</div>
    <div class="row">
      <button onclick="sendChar('F')">Forward (F)</button>
      <button onclick="sendChar('B')">Backward (B)</button>
    </div>
    <div class="row">
      <button onclick="sendChar('L')">Left (L)</button>
      <button onclick="sendChar('R')">Right (R)</button>
    </div>
    <button class="muted" style="width:100%" onclick="sendChar('S')">Stop (S)</button>
  </div>
</div>

<script>
const SERVICE_UUID = '0000abcd-0000-1000-8000-00805f9b34fb';
const CHAR_UUID    = '0000dcba-0000-1000-8000-00805f9b34fb';
let device, server, writeChar;

const statusEl = document.getElementById('status');
function setStatus(t){ statusEl.textContent = t; }

async function connect(){
  try{
    device = await navigator.bluetooth.requestDevice({
      filters: [{ namePrefix: 'My_STM32_Car' }],
      optionalServices: [SERVICE_UUID]
    });
    server = await device.gatt.connect();
    const svc = await server.getPrimaryService(SERVICE_UUID);
    writeChar = await svc.getCharacteristic(CHAR_UUID);
    device.addEventListener('gattserverdisconnected', () => setStatus('Disconnected'));
    setStatus('Connected to ' + (device.name || 'ESP32'));
  }catch(e){
    setStatus('Connect failed: ' + e);
  }
}

function disconnect(){
  try{ if(device?.gatt?.connected) device.gatt.disconnect(); }catch(e){}
  setStatus('Disconnected');
}

async function sendChar(ch){
  if(!writeChar){ setStatus('Not connected'); return; }
  try{
    await writeChar.writeValueWithoutResponse(Uint8Array.of(ch.charCodeAt(0)));
    console.log("Sent:", ch);
  }catch(e){
    setStatus('Send error: ' + e);
  }
}
</script>
</body>
</html>
